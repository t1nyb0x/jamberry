# jamberry ğŸ‡

Spotify ã®æ¥½æ›²ãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ»ã‚¢ãƒ«ãƒãƒ æƒ…å ±ã‚’ Discord ä¸Šã§ç°¡å˜ã«æ¤œç´¢ãƒ»å…±æœ‰ã§ãã‚‹ Bot ã§ã™ã€‚

## æ©Ÿèƒ½

### ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰                             | èª¬æ˜                                      |
| ------------------------------------ | ----------------------------------------- |
| `/jam track <spotify_url_or_id>`     | æ¥½æ›²æƒ…å ±ã‚’è¡¨ç¤ºï¼ˆKKBOX ãƒªãƒ³ã‚¯ä»˜ãï¼‰        |
| `/jam artist <spotify_url_or_id>`    | ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæƒ…å ±ã‚’è¡¨ç¤º                    |
| `/jam album <spotify_url_or_id>`     | ã‚¢ãƒ«ãƒãƒ æƒ…å ±ã‚’è¡¨ç¤º                        |
| `/jam recommend <spotify_url_or_id>` | æ¥½æ›²ã«åŸºã¥ããƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã‚’è¡¨ç¤ºï¼ˆ5 ä»¶ï¼‰      |
| `/jam search <query>`                | æ¥½æ›²ã‚’æ¤œç´¢ï¼ˆ10 ä»¶ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰ |

### å¯¾å¿œã™ã‚‹ Spotify ID å½¢å¼

- **Spotify URL**: `https://open.spotify.com/track/xxxxx`
- **Spotify URI**: `spotify:track:xxxxx`
- **Spotify ID**: `xxxxx`ï¼ˆ22 æ–‡å­—ã®è‹±æ•°å­—ï¼‰

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Discord   â”‚â”€â”€â”€â”€â–¶â”‚  jamberry   â”‚â”€â”€â”€â”€â–¶â”‚ tracktaste  â”‚
â”‚   (User)    â”‚â—€â”€â”€â”€â”€â”‚   (Bot)     â”‚â—€â”€â”€â”€â”€â”‚   (API)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
               â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
               â”‚ L1 Cache â”‚  â”‚ L2 Cache  â”‚
               â”‚ (Memory) â”‚  â”‚  (Redis)  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

- **L1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªï¼ˆsync.Mapï¼‰ã€TTL 10 åˆ†
- **L2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redisã€TTL 30 æ—¥

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã« 10 ç§’é–“ã§æœ€å¤§ 5 ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ–¹å¼ï¼‰

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Go 1.23+
- Docker & Docker Composeï¼ˆæ¨å¥¨ï¼‰
- Discord Bot Token
- Spotify Developer ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆClient ID / Secretï¼‰
- KKBOX Developer ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆClient ID / Secretï¼‰

### ç’°å¢ƒå¤‰æ•°

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š

```bash
cp .env.example .env
# .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦å¿…è¦ãªå€¤ã‚’è¨­å®š
```

| å¤‰æ•°å                  | èª¬æ˜                               | å¿…é ˆ             |
| ----------------------- | ---------------------------------- | ---------------- |
| `DISCORD_BOT_TOKEN`     | Discord Bot ã®ãƒˆãƒ¼ã‚¯ãƒ³             | âœ…               |
| `SPOTIFY_CLIENT_ID`     | Spotify API ã® Client ID           | âœ…               |
| `SPOTIFY_CLIENT_SECRET` | Spotify API ã® Client Secret       | âœ…               |
| `KKBOX_ID`              | KKBOX API ã® Client ID             | âœ…               |
| `KKBOX_SECRET`          | KKBOX API ã® Client Secret         | âœ…               |
| `LOG_LEVEL`             | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« (debug/info/warn/error) | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: info |

### Discord Bot ã®è¨­å®š

1. [Discord Developer Portal](https://discord.com/developers/applications) ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
2. Bot ã‚’è¿½åŠ ã—ã€Token ã‚’å–å¾—
3. OAuth2 > URL Generator ã§ä»¥ä¸‹ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’é¸æŠï¼š
   - `bot`
   - `applications.commands`
4. Bot Permissions ã§ä»¥ä¸‹ã‚’é¸æŠï¼š
   - Send Messages
   - Embed Links
   - Use Slash Commands
5. ç”Ÿæˆã•ã‚ŒãŸ URL ã§ã‚µãƒ¼ãƒãƒ¼ã« Bot ã‚’æ‹›å¾…

#### æ‹›å¾… URL ä¾‹

```
https://discord.com/api/oauth2/authorize?client_id=YOUR_CLIENT_ID&permissions=2147485696&scope=bot%20applications.commands
```

### èµ·å‹•æ–¹æ³•

#### Docker Composeï¼ˆæ¨å¥¨ï¼‰

jamberryã€tracktasteã€Redis ãŒã™ã¹ã¦èµ·å‹•ã—ã¾ã™ã€‚

```bash
# èµ·å‹•
docker compose up -d

# ãƒ­ã‚°ç¢ºèª
docker compose logs -f jamberry

# åœæ­¢
docker compose down
```

#### ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ

```bash
# Redis ã‚’èµ·å‹•
docker run -d -p 6379:6379 redis:7-alpine

# tracktaste ã‚’èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
# tracktaste ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦èµ·å‹•

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
go run ./cmd/server
```

## é–‹ç™º

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
jamberry/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go                    # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ bot/                           # Discord Bot ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ bot.go                     # Bot ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚   â””â”€â”€ commands.go                # ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰å®šç¾©
â”‚   â”œâ”€â”€ domain/                        # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰
â”‚   â”‚   â”œâ”€â”€ track.go                   # Track ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ artist.go                  # Artist ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ album.go                   # Album ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ cache.go                   # ã‚­ãƒ£ãƒƒã‚·ãƒ¥é–¢é€£
â”‚   â”‚   â””â”€â”€ repository.go              # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ usecase/                       # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ track.go                   # ãƒˆãƒ©ãƒƒã‚¯å–å¾—
â”‚   â”‚   â”œâ”€â”€ artist.go                  # ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå–å¾—
â”‚   â”‚   â”œâ”€â”€ album.go                   # ã‚¢ãƒ«ãƒãƒ å–å¾—
â”‚   â”‚   â”œâ”€â”€ recommend.go               # ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰å–å¾—
â”‚   â”‚   â”œâ”€â”€ search.go                  # æ¤œç´¢
â”‚   â”‚   â””â”€â”€ errors.go                  # ã‚¨ãƒ©ãƒ¼å®šç¾©
â”‚   â”œâ”€â”€ handler/                       # ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å±¤ï¼ˆã‚³ãƒãƒ³ãƒ‰å‡¦ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ handler.go                 # ãƒ«ãƒ¼ã‚¿ãƒ¼
â”‚   â”‚   â”œâ”€â”€ track.go                   # /jam track ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ artist.go                  # /jam artist ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ album.go                   # /jam album ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ recommend.go               # /jam recommend ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ search.go                  # /jam search ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ component.go               # ãƒœã‚¿ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â””â”€â”€ responder.go               # Discord ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ presenter/                     # ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼å±¤ï¼ˆEmbed æ§‹ç¯‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ embed.go                   # Embed ãƒ“ãƒ«ãƒ€ãƒ¼
â”‚   â”‚   â”œâ”€â”€ pagination.go              # ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â””â”€â”€ formatter.go               # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ infrastructure/                # ã‚¤ãƒ³ãƒ•ãƒ©å±¤
â”‚   â”‚   â”œâ”€â”€ tracktaste/                # tracktaste API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ client.go
â”‚   â”‚   â”‚   â”œâ”€â”€ track.go
â”‚   â”‚   â”‚   â”œâ”€â”€ artist.go
â”‚   â”‚   â”‚   â””â”€â”€ album.go
â”‚   â”‚   â””â”€â”€ cache/                     # ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…
â”‚   â”‚       â””â”€â”€ cache.go
â”‚   â”œâ”€â”€ config/                        # è¨­å®š
â”‚   â”œâ”€â”€ logger/                        # ãƒ­ã‚¬ãƒ¼
â”‚   â”œâ”€â”€ ratelimit/                     # ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â””â”€â”€ spotify/                       # Spotify ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ spec/
â”‚       â”œâ”€â”€ SPEC.md                    # æŠ€è¡“ä»•æ§˜æ›¸
â”‚       â”œâ”€â”€ USECASE.md                 # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ä»•æ§˜æ›¸
â”‚       â”œâ”€â”€ ARCHITECTURE.md            # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜æ›¸
â”‚       â””â”€â”€ TEST_SPEC.md               # ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸
â”œâ”€â”€ compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ go.mod
â””â”€â”€ README.md
```

è©³ç´°ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦ã¯ [docs/spec/ARCHITECTURE.md](docs/spec/ARCHITECTURE.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ“ãƒ«ãƒ‰

```bash
go build -o jamberry ./cmd/server
```

### ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
go test ./...

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãå®Ÿè¡Œ
go test ./internal/... -cover

# è©³ç´°ãªãƒ†ã‚¹ãƒˆãƒ­ã‚°
go test ./internal/... -v
```

ãƒ†ã‚¹ãƒˆä»•æ§˜ã®è©³ç´°ã¯ [docs/spec/TEST_SPEC.md](docs/spec/TEST_SPEC.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ä¾å­˜ã‚µãƒ¼ãƒ“ã‚¹

### tracktaste

Spotify ãŠã‚ˆã³ KKBOX ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ APIã€‚

- ãƒªãƒã‚¸ãƒˆãƒª: `ghcr.io/t1nyb0x/tracktaste`
- å†…éƒ¨ãƒãƒ¼ãƒˆ: 8080

### Redis

L2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä½¿ç”¨ã€‚

- ã‚¤ãƒ¡ãƒ¼ã‚¸: `redis:7-alpine`
- å†…éƒ¨ãƒãƒ¼ãƒˆ: 6379

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è©³ç´°ã¯ [LICENSE](LICENSE) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
